# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stripe –¥–ª—è Podcast Tracker

## 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Stripe –∫–ª—é—á–µ–π

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –≤–∞—à `.env.local` —Ñ–∞–π–ª:

```env
# Stripe
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_publishable_key_here
STRIPE_SECRET_KEY=sk_test_your_secret_key_here
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret
```

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ–¥–ø–∏—Å–æ–∫:

```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL –≤ Supabase SQL Editor
-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: migrations/add_subscriptions_table.sql
```

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stripe Webhook

1. –í Stripe Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Webhooks"
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π webhook endpoint: `https://your-domain.com/api/stripe/webhook`
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è:
   - `checkout.session.completed`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
   - `invoice.payment_succeeded`
   - `invoice.payment_failed`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ webhook secret –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`

## 4. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ Stripe

–í Stripe Dashboard —Å–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã:

### Starter Plan ($10/–º–µ—Å—è—Ü)
- Product Name: "Starter Plan"
- Price: $10.00 USD, recurring monthly

### Pro Plan ($20/–º–µ—Å—è—Ü)
- Product Name: "Pro Plan" 
- Price: $20.00 USD, recurring monthly

### Agency Plan ($99/–º–µ—Å—è—Ü)
- Product Name: "Agency Plan"
- Price: $99.00 USD, recurring monthly

## 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `npm run dev`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/billing`
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Stripe:
   - –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞: `4242 4242 4242 4242`
   - –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞: `4000 0000 0000 0002`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok: `npm install -g ngrok`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å: `ngrok http 3000`
3. –û–±–Ω–æ–≤–∏—Ç–µ webhook URL –≤ Stripe –Ω–∞ ngrok URL
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–¥–ø–∏—Å–∫–∏

## 6. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø–ª–∞–Ω–æ–≤**: –¢–µ–ø–µ—Ä—å –ø–ª–∞–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `subscriptions` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ webhook

‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `subscriptions` —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –¢—Ä–∏–≥–≥–µ—Ä—ã –≤ –ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç –ø–ª–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

‚úÖ **API endpoints**: –î–æ–±–∞–≤–ª–µ–Ω `/api/user/subscription` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏

## 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ webhook –≤ Stripe Dashboard
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `subscriptions` –≤ Supabase
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Stripe CLI –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è webhook

## 8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ Stripe –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è development/production
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –¥–ª—è webhook endpoint
- –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ webhook –ø–æ–¥–ø–∏—Å–∏
